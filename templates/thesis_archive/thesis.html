<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <title>Lưu Trữ Luận Văn - Thesis Archive</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    {% include 'header.html' %}
    <main id="app">
        <div class="thesis-container">
            <h1
                style="color: var(--cultural-red); font-family: var(--font-heading); text-align: center; margin-bottom: 30px;">
                Lưu Trữ Luận Văn / Thesis Archive</h1>
            <div class="search-bar" style="max-width: 800px; margin: 0 auto 30px auto; gap: 12px;">
                <input type="text" id="search-input"
                    placeholder="Tìm kiếm theo tiêu đề, tác giả, danh mục... / Search thesis..."
                    onkeydown="if(event.key==='Enter') searchThesis()">
                <button onclick="searchThesis()">Tìm Kiếm / Search</button>
            </div>
            <div id="results-area"></div>
        </div>

        <script>
            async function searchThesis() {
                const query = document.getElementById('search-input').value;
                const container = document.getElementById('results-area');
                container.innerHTML = '<p>Searching...</p>';
                try {
                    const res = await fetch(`/thesis/search?q=${encodeURIComponent(query)}`);
                    const html = await res.text();
                    // Parse the response to extract body content if it's a full page
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    // Remove header from the fetched content if present (to avoid nesting headers in search results)
                    const header = doc.querySelector('header');
                    if (header) header.remove();
                    container.innerHTML = doc.body ? doc.body.innerHTML : html;
                } catch (err) {
                    container.innerHTML = '<p>Error loading results.</p>';
                }
            }

            // Load all thesis cards on page load
            document.addEventListener('DOMContentLoaded', searchThesis);
        </script>
</body>