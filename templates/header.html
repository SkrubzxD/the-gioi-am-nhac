<header>
    <h1>The Gioi Am Nhac</h1>

    <nav id="main-nav">
        {# Render Home first if present #}
        {% for item in nav_items %}
            {% if item.href == '/' %}
                <div class="nav-home"><a href="{{ item.href }}">{{ item.text }}</a></div>
            {% endif %}
        {% endfor %}

        {# Group remaining items by top-level folder in href (e.g. /quiz/question -> quiz) #}
        {% set ns = namespace(current=None) %}
        {% for item in nav_items %}
            {% if item.href != '/' %}
                {% set p = item.href.strip('/') %}
                {% set top = p.split('/')[0] %}

                {% if top != ns.current %}
                    {% if ns.current is not none %}
                        </div> <!-- .nav-group-items -->
                        </div> <!-- .nav-group -->
                    {% endif %}
                    <div class="nav-group">
                        <div class="nav-group-title" data-group="{{ top }}">{{ top.replace('_',' ')|title }}</div>
                        <div class="nav-group-items" style="display:none;">
                    {% set ns.current = top %}
                {% endif %}

                <a class="nav-link" href="{{ item.href }}">{{ item.text }}</a><br>
            {% endif %}
        {% endfor %}
        {% if ns.current is not none %}
            </div></div>
        {% endif %}
    </nav>

    <style>
        #main-nav { margin: 8px 0 16px 0; }
        #main-nav .nav-home a { font-weight: bold; font-size: 1.1em; }
        .nav-group { margin: 6px 0; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .nav-group-title { cursor: pointer; padding: 6px 0; font-weight:600; }
        .nav-group-items { padding-left: 12px; }
        .nav-link { color: inherit; text-decoration: none; }
    </style>

    <script>
        document.addEventListener('click', function (e) {
            const t = e.target.closest('.nav-group-title');
            if (!t) return;
            const group = t.nextElementSibling;
            if (!group) return;
            
            const isOpen = group.style.display === 'block';
            
            // Close all other nav groups
            document.querySelectorAll('.nav-group-items').forEach(g => {
                g.style.display = 'none';
            });
            
            // Toggle the clicked group
            group.style.display = isOpen ? 'none' : 'block';
        });
    </script>
</header>